# Codex Configuration for Amplifier Project
#
# CONFIGURATION MANAGEMENT:
# This file is automatically copied to ~/.codex/config.toml by the amplify-codex.sh wrapper script
# before launching Codex CLI. Always edit this project file (.codex/config.toml), not the copy in
# your home directory. Changes take effect on the next wrapper script invocation. Direct edits to
# ~/.codex/config.toml will be overwritten.
#
# WARNING: Many configuration keys in this file are placeholders and should be verified
# with the current Codex CLI documentation before use. Uncomment and test keys
# individually to ensure compatibility with your Codex version.
#
# This configuration provides dual-backend support alongside Claude Code (.claude/ directory)
# See .codex/README.md for detailed documentation

# =============================================================================
# Top-level Settings
# =============================================================================

# Model configuration (equivalent to .claude/settings.json model settings)
model = "gpt-5-codex"
# provider = "anthropic"  # PLACEHOLDER: Verify with Codex CLI docs
reasoning_effort = "medium"  # PLACEHOLDER: Verify with Codex CLI docs

# Approval policy for tool usage
# Options: "on-request" (user approval), "never" (auto-approve), "always" (ask every time)
# Equivalent to Claude Code's approval settings
# approval_policy = "on-request"  # PLACEHOLDER: Verify with Codex CLI docs

# Sandbox mode for workspace access
# Options: "workspace-write" (full access), "read-only" (limited access)
# sandbox_mode = "workspace-write"  # PLACEHOLDER: Verify with Codex CLI docs

# Timeout settings (in seconds)
startup_timeout_sec = 30
tool_timeout_sec = 300

# Experimental features flag
# Enable remote MCP client capabilities
experimental_use_rmcp_client = false

# =============================================================================
# Custom Prompts Configuration
# =============================================================================

# IMPORTANT: The [prompts] section may not be supported in all Codex versions.
# If you experience config parsing errors, keep this section commented out.
# The reliable fallback is: codex exec --context-file=.codex/prompts/prompt-name.md
#
# [prompts]
# # Project-specific prompts directory (in addition to ~/.codex/prompts)
# directories = [".codex/prompts"]

# =============================================================================
# Shell Environment Policy
# =============================================================================

# Environment variables to expose to Codex sessions
# Security consideration: Only include necessary variables
[env_allow]
PATH = true
HOME = true
AMPLIFIER_ROOT = true
VIRTUAL_ENV = true
CONDA_DEFAULT_ENV = true

# =============================================================================
# Session Monitor Configuration
# =============================================================================

[session_monitor]
workspace_base_dir = ".codex/workspaces"
check_interval_seconds = 5
token_warning_threshold = 80.0
token_critical_threshold = 90.0
max_restart_attempts = 3
restart_backoff_seconds = 2

# =============================================================================
# MCP Servers Section - Implemented and ready for use
# =============================================================================
# These MCP servers replace Claude Code's native hooks system:
# - SessionStart/Stop hooks → amplifier_session MCP server
# - PostToolUse hook → amplifier_quality MCP server
# - PreCompact hook → amplifier_transcripts MCP server

# Session Management MCP Server
# Replaces: .claude/hooks/SessionStart.py and SessionStop.py
[mcp_servers.amplifier_session]
command = "uv"
args = ["run", "--directory", "/Users/aleksandarilic/Documents/github/acailic/improvements-ampl/amplifier-adding-codex", "python", ".codex/mcp_servers/session_manager/server.py"]
env = { AMPLIFIER_ROOT = "/Users/aleksandarilic/Documents/github/acailic/improvements-ampl/amplifier-adding-codex", PYTHONPATH = "/Users/aleksandarilic/Documents/github/acailic/improvements-ampl/amplifier-adding-codex" }
timeout = 30
# Purpose: Initialize session context, set up workspace, handle session cleanup

# Code Quality Checker MCP Server
# Replaces: .claude/hooks/PostToolUse.py
[mcp_servers.amplifier_quality]
command = "uv"
args = ["run", "--directory", "/Users/aleksandarilic/Documents/github/acailic/improvements-ampl/amplifier-adding-codex", "python", ".codex/mcp_servers/quality_checker/server.py"]
env = { AMPLIFIER_ROOT = "/Users/aleksandarilic/Documents/github/acailic/improvements-ampl/amplifier-adding-codex", PYTHONPATH = "/Users/aleksandarilic/Documents/github/acailic/improvements-ampl/amplifier-adding-codex" }
timeout = 30
# Purpose: Run code quality checks after tool usage, validate changes

# Transcript Management MCP Server
# Replaces: .claude/hooks/PreCompact.py
[mcp_servers.amplifier_transcripts]
command = "uv"
args = ["run", "--directory", "/Users/aleksandarilic/Documents/github/acailic/improvements-ampl/amplifier-adding-codex", "python", ".codex/mcp_servers/transcript_saver/server.py"]
env = { AMPLIFIER_ROOT = "/Users/aleksandarilic/Documents/github/acailic/improvements-ampl/amplifier-adding-codex", PYTHONPATH = "/Users/aleksandarilic/Documents/github/acailic/improvements-ampl/amplifier-adding-codex" }
timeout = 30
# Purpose: Save and manage session transcripts, integrate with existing transcript system

# Task Tracker MCP Server
# Replaces: Claude Code's TodoWrite functionality
[mcp_servers.amplifier_tasks]
command = "uv"
args = ["run", "--directory", "/Users/aleksandarilic/Documents/github/acailic/improvements-ampl/amplifier-adding-codex", "python", ".codex/mcp_servers/task_tracker/server.py"]
env = { AMPLIFIER_ROOT = "/Users/aleksandarilic/Documents/github/acailic/improvements-ampl/amplifier-adding-codex", PYTHONPATH = "/Users/aleksandarilic/Documents/github/acailic/improvements-ampl/amplifier-adding-codex" }
timeout = 30
# Purpose: Provide task management within Codex sessions, replicating TodoWrite

# Web Research MCP Server
# Replaces: Claude Code's WebFetch functionality
[mcp_servers.amplifier_web]
command = "uv"
args = ["run", "--directory", "/Users/aleksandarilic/Documents/github/acailic/improvements-ampl/amplifier-adding-codex", "python", ".codex/mcp_servers/web_research/server.py"]
env = { AMPLIFIER_ROOT = "/Users/aleksandarilic/Documents/github/acailic/improvements-ampl/amplifier-adding-codex", PYTHONPATH = "/Users/aleksandarilic/Documents/github/acailic/improvements-ampl/amplifier-adding-codex" }
timeout = 60
# Purpose: Provide web search and content fetching capabilities within Codex sessions

# Notifications MCP Server
# Provides: Desktop notifications for task completion and errors
[mcp_servers.amplifier_notifications]
command = "uv"
args = ["run", "--directory", "/Users/aleksandarilic/Documents/github/acailic/improvements-ampl/amplifier-adding-codex", "python", ".codex/mcp_servers/notifications/server.py"]
env = { AMPLIFIER_ROOT = "/Users/aleksandarilic/Documents/github/acailic/improvements-ampl/amplifier-adding-codex", PYTHONPATH = "/Users/aleksandarilic/Documents/github/acailic/improvements-ampl/amplifier-adding-codex" }
timeout = 30
# Purpose: Send desktop notifications for task completion, errors, and important events

# Token Monitor MCP Server
# Provides: Token usage tracking, checkpoint/resume data, and termination tooling
[mcp_servers.token_monitor]
command = "uv"
args = ["run", "--directory", "/Users/aleksandarilic/Documents/github/acailic/improvements-ampl/amplifier-adding-codex", "python", ".codex/mcp_servers/token_monitor/server.py"]
env = { AMPLIFIER_ROOT = "/Users/aleksandarilic/Documents/github/acailic/improvements-ampl/amplifier-adding-codex", PYTHONPATH = "/Users/aleksandarilic/Documents/github/acailic/improvements-ampl/amplifier-adding-codex" }
timeout = 30
# Purpose: Monitor token usage, handle termination requests, and surface daemon health checks

# Hooks Orchestration MCP Server
# Provides: Automatic triggers for file changes, session events, periodic tasks
[mcp_servers.amplifier_hooks]
command = "uv"
args = ["run", "--directory", "/Users/aleksandarilic/Documents/github/acailic/improvements-ampl/amplifier-adding-codex", "python", ".codex/mcp_servers/hooks/server.py"]
env = { AMPLIFIER_ROOT = "/Users/aleksandarilic/Documents/github/acailic/improvements-ampl/amplifier-adding-codex", PYTHONPATH = "/Users/aleksandarilic/Documents/github/acailic/improvements-ampl/amplifier-adding-codex" }
timeout = 60
# Purpose: Orchestrate automatic hooks for file changes, session events, and periodic tasks

# Agent Analytics MCP Server
# Provides: Tracking and analysis of agent usage patterns
[mcp_servers.amplifier_agent_analytics]
command = "uv"
args = ["run", "--directory", "/Users/aleksandarilic/Documents/github/acailic/improvements-ampl/amplifier-adding-codex", "python", ".codex/mcp_servers/agent_analytics/server.py"]
env = { AMPLIFIER_ROOT = "/Users/aleksandarilic/Documents/github/acailic/improvements-ampl/amplifier-adding-codex", PYTHONPATH = "/Users/aleksandarilic/Documents/github/acailic/improvements-ampl/amplifier-adding-codex" }
timeout = 30
# Purpose: Track agent executions, provide usage statistics and recommendations

# Memory Enhancement MCP Server
# Provides: Proactive memory suggestions and quality management
[mcp_servers.amplifier_memory_enhanced]
command = "uv"
args = ["run", "--directory", "/Users/aleksandarilic/Documents/github/acailic/improvements-ampl/amplifier-adding-codex", "python", ".codex/mcp_servers/memory_enhanced/server.py"]
env = { AMPLIFIER_ROOT = "/Users/aleksandarilic/Documents/github/acailic/improvements-ampl/amplifier-adding-codex", PYTHONPATH = "/Users/aleksandarilic/Documents/github/acailic/improvements-ampl/amplifier-adding-codex" }
timeout = 30
# Purpose: Provide proactive memory suggestions and manage memory quality

# =============================================================================
# Profiles Section - Configure which servers to use per profile
# =============================================================================

# Development profile - permissive settings for active development
[profiles.development]
# approval_policy = "never"  # PLACEHOLDER: Verify with Codex CLI docs
# sandbox_mode = "workspace-write"  # PLACEHOLDER: Verify with Codex CLI docs
tool_timeout_sec = 600
# All MCP servers enabled for full development experience
mcp_servers = ["amplifier_session", "amplifier_quality", "amplifier_transcripts", "amplifier_tasks", "amplifier_web", "amplifier_notifications", "amplifier_hooks", "amplifier_agent_analytics", "amplifier_memory_enhanced", "token_monitor"]

# CI profile - restrictive settings for automated environments
[profiles.ci]
# approval_policy = "never"  # PLACEHOLDER: Verify with Codex CLI docs
# sandbox_mode = "read-only"  # PLACEHOLDER: Verify with Codex CLI docs
tool_timeout_sec = 120
# Only quality checks enabled for CI - no memory or transcript operations
mcp_servers = ["amplifier_quality"]

# Review profile - settings optimized for code review workflows
[profiles.review]
# approval_policy = "on-request"  # PLACEHOLDER: Verify with Codex CLI docs
# sandbox_mode = "workspace-write"  # PLACEHOLDER: Verify with Codex CLI docs
tool_timeout_sec = 300
# Quality checks, transcript export, and task tracking for code review workflows
mcp_servers = ["amplifier_quality", "amplifier_transcripts", "amplifier_tasks", "amplifier_agent_analytics", "amplifier_memory_enhanced", "token_monitor"]

# =============================================================================
# Optional Extensions (Disabled by Default)
# =============================================================================
# The sections below are placeholders for extended functionality.
# Uncomment and configure as needed once basic MCP servers are implemented.

# # Transcript integration with existing tools/codex_transcripts_builder.py
# [transcripts]
# # Local transcript storage (supplements ~/.codex/transcripts/)
# local_storage = ".codex/transcripts/"
# # Integration with project transcript management
# builder_integration = true
# # Format compatibility with Claude Code transcripts
# claude_compatibility = true

# # Agent execution settings
# [agents]
# # Default timeout for agent execution via 'codex exec'
# execution_timeout = 1800
# # Working directory for agent execution
# work_dir = "."
# # Environment inheritance
# inherit_env = true

# # Debugging and Logging
# [logging]
# # Log level for MCP server communication
# level = "INFO"
# # Log file location (relative to project root)
# file = ".codex/codex.log"
# # Enable detailed MCP protocol logging
# mcp_debug = false

# =============================================================================
# MCP Server-Specific Configuration
# =============================================================================

[mcp_server_config.amplifier_session]
# Memory system configuration
memory_enabled = true  # Can be overridden by MEMORY_SYSTEM_ENABLED env var
memory_search_limit = 5
recent_memory_limit = 3

[mcp_server_config.amplifier_quality]
# Quality check configuration
check_timeout = 300  # seconds
auto_fix = false  # Whether to attempt automatic fixes
strict_mode = false  # Fail on warnings, not just errors

[mcp_server_config.amplifier_transcripts]
# Transcript export configuration
default_format = "both"  # standard, extended, both, or compact
output_dir = ".codex/transcripts"  # Relative to project root
incremental = true  # Skip already-exported sessions

[mcp_server_config.amplifier_tasks]
# Task tracker configuration
task_storage_path = ".codex/tasks/session_tasks.json"
max_tasks_per_session = 50

[mcp_server_config.amplifier_web]
# Web research configuration
cache_enabled = true
cache_ttl_hours = 24
max_results = 10

[mcp_server_config.amplifier_notifications]
# Notifications configuration
desktop_notifications = true
notification_history_limit = 100

[mcp_server_config.amplifier_hooks]
# Hooks orchestration configuration
auto_enable_file_watch = false
check_interval_seconds = 5

[mcp_server_config.amplifier_agent_analytics]
# Agent analytics configuration
retention_days = 90
auto_log_enabled = true

[mcp_server_config.amplifier_memory_enhanced]
# Memory enhancement configuration
auto_suggest_enabled = true
quality_threshold = 0.3

[mcp_server_config.token_monitor]
# Token monitor configuration
warning_threshold_pct = 80.0  # Warn when token usage exceeds this percentage
critical_threshold_pct = 90.0  # Create termination request when exceeded
max_token_limit = 128000  # Maximum tokens for Claude Code sessions
check_interval_seconds = 30  # How often to check token usage
workspace_dir = ".codex/workspaces"  # Directory for workspace-specific files
termination_timeout_seconds = 300  # How long to wait for graceful termination
restart_backoff_seconds = 5  # Initial backoff for restart attempts
